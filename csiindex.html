<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Digital Pinboard</title>

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    overflow: hidden;
  }

  #toolbar {
    position: fixed;
    top: 10px;
    left: 10px;
    background: #ffffff;
    padding: 10px;
    border-radius: 6px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    z-index: 1000;
  }

  #board {
    width: 100vw;
    height: 100vh;
    background: #f4f4f4;
    position: relative;
    overflow: hidden;
  }

  .pin {
    position: absolute;
    background: #fff8b5;
    padding: 10px;
    border-radius: 6px;
    cursor: grab;
    min-width: 120px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }

  .pin img {
    max-width: 200px;
    display: block;
  }

  .pin button {
    background: red;
    color: white;
    border: none;
    padding: 2px 6px;
    cursor: pointer;
    float: right;
  }
</style>
</head>

<body>

<div id="toolbar">
  <button onclick="addTextPin()">➕ Text Pin</button>
  <input type="file" onchange="addImagePin(event)">
  <button onclick="undo()">↩ Undo</button>
  <button onclick="redo()">↪ Redo</button>
</div>

<div id="board"></div>

<script>
  const board = document.getElementById("board");

  let pins = JSON.parse(localStorage.getItem("pins")) || [];
  let history = [];
  let future = [];

  function save() {
    localStorage.setItem("pins", JSON.stringify(pins));
  }

  function snapshot() {
    history.push(JSON.stringify(pins));
    future = [];
  }

  function undo() {
    if (!history.length) return;
    future.push(JSON.stringify(pins));
    pins = JSON.parse(history.pop());
    render();
  }

  function redo() {
    if (!future.length) return;
    history.push(JSON.stringify(pins));
    pins = JSON.parse(future.pop());
    render();
  }

  function addTextPin() {
    snapshot();
    pins.push({
      id: Date.now(),
      x: 100,
      y: 100,
      text: prompt("Enter text")
    });
    save();
    render();
  }

  function addImagePin(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
      snapshot();
      pins.push({
        id: Date.now(),
        x: 150,
        y: 150,
        image: reader.result
      });
      save();
      render();
    };
    reader.readAsDataURL(file);
  }

  function deletePin(id) {
    snapshot();
    pins = pins.filter(p => p.id !== id);
    save();
    render();
  }

  function render() {
    board.innerHTML = "";
    pins.forEach(pin => {
      const el = document.createElement("div");
      el.className = "pin";
      el.style.left = pin.x + "px";
      el.style.top = pin.y + "px";
      el.dataset.id = pin.id;

      const del = document.createElement("button");
      del.textContent = "x";
      del.onclick = () => deletePin(pin.id);
      el.appendChild(del);

      if (pin.text) {
        el.innerHTML += `<p>${pin.text}</p>`;
      }

      if (pin.image) {
        const img = document.createElement("img");
        img.src = pin.image;
        el.appendChild(img);
      }

      enableDrag(el, pin);
      board.appendChild(el);
    });
  }

  function enableDrag(el, pin) {
    let offsetX, offsetY;

    el.onmousedown = e => {
      snapshot();
      offsetX = e.clientX - pin.x;
      offsetY = e.clientY - pin.y;

      document.onmousemove = e => {
        pin.x = e.clientX - offsetX;
        pin.y = e.clientY - offsetY;
        el.style.left = pin.x + "px";
        el.style.top = pin.y + "px";
      };

      document.onmouseup = () => {
        document.onmousemove = null;
        document.onmouseup = null;
        save();
      };
    };
  }

  render();
</script>

</body>
</html>
