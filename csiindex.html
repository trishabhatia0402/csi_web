<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Digital Pinboard</title>

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    overflow: hidden;
    background: #f2f2f2;
  }

  #toolbar {
    position: fixed;
    top: 10px;
    left: 10px;
    background: white;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    z-index: 1000;
    display: flex;
    gap: 6px;
    align-items: center;
  }

  #board {
    width: 100vw;
    height: 100vh;
    position: relative;
  }

  .pin {
    position: absolute;
    background: #fff8b5;
    padding: 10px;
    border-radius: 6px;
    min-width: 120px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    cursor: grab;
  }

  .pin.selected {
    outline: 2px solid #2196f3;
  }

  .pin img {
    max-width: 200px;
    min-width: 120px;
    height: auto;
    display: block;
    pointer-events: none;
  }

  .pin small {
    display: block;
    margin-top: 6px;
    color: #555;
  }

  .delete-btn {
    background: red;
    color: white;
    border: none;
    padding: 2px 6px;
    cursor: pointer;
    float: right;
  }
</style>
</head>

<body>

<div id="toolbar">
  <button onclick="addTextPin()">âž• Text</button>
  <input type="file" onchange="addImagePin(event)">
  <button onclick="undo()">â†©</button>
  <button onclick="redo()">â†ª</button>
  <button onclick="saveSnapshot()">ðŸ’¾</button>
  <select id="snapshots" onchange="loadSnapshot(this.value)">
    <option value="">Load Snapshot</option>
  </select>
</div>

<div id="board"></div>

<script>
  const board = document.getElementById("board");
  const snapshotSelect = document.getElementById("snapshots");

  let pins = JSON.parse(localStorage.getItem("pins")) || [];
  let history = [];
  let future = [];
  let snapshots = JSON.parse(localStorage.getItem("snapshots")) || [];
  let selectedPinId = null;

  function save() {
    localStorage.setItem("pins", JSON.stringify(pins));
  }

  function snapshot() {
    history.push(JSON.stringify(pins));
    future = [];
  }

  function undo() {
    if (!history.length) return;
    future.push(JSON.stringify(pins));
    pins = JSON.parse(history.pop());
    render();
  }

  function redo() {
    if (!future.length) return;
    history.push(JSON.stringify(pins));
    pins = JSON.parse(future.pop());
    render();
  }

  function addTextPin() {
    const text = prompt("Enter pin text");
    if (!text) return;

    snapshot();
    pins.push({
      id: Date.now(),
      x: 100,
      y: 100,
      text,
      tags: prompt("Tags (comma separated)")?.split(",").map(t => t.trim()) || []
    });
    save();
    render();
  }

  function addImagePin(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
      snapshot();
      pins.push({
        id: Date.now(),
        x: 150,
        y: 150,
        image: reader.result,
        tags: prompt("Tags (comma separated)")?.split(",").map(t => t.trim()) || []
      });
      save();
      render();
    };
    reader.readAsDataURL(file);
  }

  function deletePin(id) {
    snapshot();
    pins = pins.filter(p => p.id !== id);
    selectedPinId = null;
    save();
    render();
  }

  function saveSnapshot() {
    const name = prompt("Snapshot name:");
    if (!name) return;

    snapshots.push({
      name,
      state: JSON.stringify(pins)
    });

    localStorage.setItem("snapshots", JSON.stringify(snapshots));
    updateSnapshotDropdown();
  }

  function loadSnapshot(index) {
    if (index === "") return;
    snapshot();
    pins = JSON.parse(snapshots[index].state);
    render();
  }

  function updateSnapshotDropdown() {
    snapshotSelect.innerHTML = `<option value="">Load Snapshot</option>`;
    snapshots.forEach((s, i) => {
      snapshotSelect.innerHTML += `<option value="${i}">${s.name}</option>`;
    });
  }

  function render() {
    board.innerHTML = "";
    pins.forEach(pin => {
      const el = document.createElement("div");
      el.className = "pin";
      el.style.left = pin.x + "px";
      el.style.top = pin.y + "px";

      if (pin.id === selectedPinId) el.classList.add("selected");

      const del = document.createElement("button");
      del.textContent = "x";
      del.className = "delete-btn";
      del.onclick = () => deletePin(pin.id);
      el.appendChild(del);

      if (pin.text) {
        const p = document.createElement("p");
        p.textContent = pin.text;
        el.appendChild(p);
      }

      if (pin.image) {
        const img = document.createElement("img");
        img.src = pin.image;
        el.appendChild(img);
      }

      if (pin.tags?.length) {
        const tag = document.createElement("small");
        tag.textContent = "ðŸ· " + pin.tags.join(", ");
        el.appendChild(tag);
      }

      el.onclick = e => {
        e.stopPropagation();
        selectedPinId = pin.id;
        render();
      };

      enableDrag(el, pin);
      board.appendChild(el);
    });
  }

  function enableDrag(el, pin) {
    let offsetX, offsetY;

    el.onmousedown = e => {
      snapshot();
      offsetX = e.clientX - pin.x;
      offsetY = e.clientY - pin.y;

      document.onmousemove = e => {
        pin.x = e.clientX - offsetX;
        pin.y = e.clientY - offsetY;
        el.style.left = pin.x + "px";
        el.style.top = pin.y + "px";
      };

      document.onmouseup = () => {
        document.onmousemove = null;
        document.onmouseup = null;
        save();
      };
    };
  }

  document.addEventListener("keydown", e => {
    if (e.ctrlKey && e.key === "z") undo();
    if (e.ctrlKey && e.key === "y") redo();
    if (e.key === "Delete" && selectedPinId) {
      deletePin(selectedPinId);
    }
  });

  board.onclick = () => {
    selectedPinId = null;
    render();
  };

  updateSnapshotDropdown();
  render();
</script>

</body>
</html>
